<?xml version="1.0" encoding="UTF-8"?>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
  <link rel="stylesheet" type="text/css" media="all"
          href="panel.css"/>
  <script type="text/javascript" src="base32.js"/>
  <script type="text/javascript" src="jquery-1.4.2.min.js"/>
  <script type="text/javascript" src="panel.js"/>
  </head>

  <body>
        <div class="dashboardclipper" style="width: 400px; height: 400px;" id="clipper">
        <!-- 
          <div class="dashboard" id="dashboard">
            <div class="page" id="page0">
            </div>
          </div>
        -->
        </div>
  </body>

  <script type="text/javascript">
    var html_datasource;
    var myLayout;
    var myDash;

    function onfocus(event)
    {
      myDash.refresh();
    }

    $(document).ready(function() {
      html_datasource = {

        gridCallback: undefined,

        //handle requests for the dashboardstate
        loadIconGridState: function(callback) {
          navigator.apps.mgmt.loadState(callback);
        },

        saveIconGridState: function(state) {
          navigator.apps.mgmt.saveState(state);
        },

        annotateAppList: function(appList) {
          var id;
          for (id in appList) {
            var item = appList[id];
            this.annotateApp(item);
          };
      
          //add in special one
          appList["about:apps"] = {};
          this.gridCallback(appList);
        },

        getItemList: function(callback) {
          var self = this;
          self.gridCallback = callback;
          navigator.apps.mgmt.list( function(theApps) { self.annotateAppList(theApps)});
        },

        openItem: function(itemID) {
          if (itemID == "about:apps") {  //I'm not allowed to open about:apps.  so sad.
            window.open("http://www.valdosta.edu/~mkstrickland/sad_face.jpg");
          } else {
            navigator.apps.mgmt.launch(itemID);
          }
        },

        annotateApp: function(anApp) {
          anApp.itemTitle = anApp.manifest.name;

          var imgURL;
          var z, size, bigSize = 0;

          //return biggest icon for now
          if (anApp.manifest.icons) {    
            for (z in anApp.manifest.icons) {
              size = parseInt(z, 10);
              if (size > bigSize) bigSize = size;
            }
            if (bigSize !== 0) imgURL = anApp.manifest.icons[bigSize];
          }

          if (imgURL && imgURL.indexOf('/') === 0) { imgURL = anApp.origin + imgURL;}

          anApp.itemImgURL = imgURL;
        },

        //if all your items have 'imgURL' and 'itemTitle' properties, then you don't need to implement these.  These get called when an item doesn't have the right properties.
        getItemImgURL: function(itemID) {if (itemID == "about:apps") return "data:image/png;base64,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" },
        getItemTitle: function(itemID) { return "App Settings"; },
        };


        var hostElement = $("#clipper");
        myLayout = new GridLayout(hostElement.width(), hostElement.height(), 4, 4);
        myDash = new IconGrid("mydash", hostElement, html_datasource, myLayout);

        myDash.initialize();
        myDash.refresh();
      });
  </script>
</html>
